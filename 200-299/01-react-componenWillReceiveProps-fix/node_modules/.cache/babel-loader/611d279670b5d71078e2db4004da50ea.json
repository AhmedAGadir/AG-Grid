{"ast":null,"code":"/**\n * ag-grid-community - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components\n * @version v19.1.4\n * @link http://www.ag-grid.com/\n * @license MIT\n */\n\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar context_1 = require(\"../context/context\");\n\nvar gridSerializer_1 = require(\"./gridSerializer\");\n\nvar downloader_1 = require(\"./downloader\");\n\nvar columnController_1 = require(\"../columnController/columnController\");\n\nvar valueService_1 = require(\"../valueService/valueService\");\n\nvar gridOptionsWrapper_1 = require(\"../gridOptionsWrapper\");\n\nvar constants_1 = require(\"../constants\");\n\nvar utils_1 = require(\"../utils\");\n\nvar LINE_SEPARATOR = '\\r\\n';\n\nvar CsvSerializingSession =\n/** @class */\nfunction (_super) {\n  __extends(CsvSerializingSession, _super);\n\n  function CsvSerializingSession(config) {\n    var _this = _super.call(this, {\n      columnController: config.columnController,\n      valueService: config.valueService,\n      gridOptionsWrapper: config.gridOptionsWrapper,\n      processCellCallback: config.processCellCallback,\n      processHeaderCallback: config.processHeaderCallback\n    }) || this;\n\n    _this.result = '';\n    _this.lineOpened = false;\n    var suppressQuotes = config.suppressQuotes,\n        columnSeparator = config.columnSeparator;\n    _this.suppressQuotes = suppressQuotes;\n    _this.columnSeparator = columnSeparator;\n    return _this;\n  }\n\n  CsvSerializingSession.prototype.prepare = function (columnsToExport) {};\n\n  CsvSerializingSession.prototype.addCustomHeader = function (customHeader) {\n    if (!customHeader) return;\n    this.result += customHeader + LINE_SEPARATOR;\n  };\n\n  CsvSerializingSession.prototype.addCustomFooter = function (customFooter) {\n    if (!customFooter) return;\n    this.result += customFooter + LINE_SEPARATOR;\n  };\n\n  CsvSerializingSession.prototype.onNewHeaderGroupingRow = function () {\n    if (this.lineOpened) this.result += LINE_SEPARATOR;\n    return {\n      onColumn: this.onNewHeaderGroupingRowColumn.bind(this)\n    };\n  };\n\n  CsvSerializingSession.prototype.onNewHeaderGroupingRowColumn = function (header, index, span) {\n    if (index != 0) {\n      this.result += this.columnSeparator;\n    }\n\n    this.result += this.putInQuotes(header, this.suppressQuotes);\n\n    for (var i = 1; i <= span; i++) {\n      this.result += this.columnSeparator + this.putInQuotes(\"\", this.suppressQuotes);\n    }\n\n    this.lineOpened = true;\n  };\n\n  CsvSerializingSession.prototype.onNewHeaderRow = function () {\n    if (this.lineOpened) this.result += LINE_SEPARATOR;\n    return {\n      onColumn: this.onNewHeaderRowColumn.bind(this)\n    };\n  };\n\n  CsvSerializingSession.prototype.onNewHeaderRowColumn = function (column, index, node) {\n    if (index != 0) {\n      this.result += this.columnSeparator;\n    }\n\n    this.result += this.putInQuotes(this.extractHeaderValue(column), this.suppressQuotes);\n    this.lineOpened = true;\n  };\n\n  CsvSerializingSession.prototype.onNewBodyRow = function () {\n    if (this.lineOpened) this.result += LINE_SEPARATOR;\n    return {\n      onColumn: this.onNewBodyRowColumn.bind(this)\n    };\n  };\n\n  CsvSerializingSession.prototype.onNewBodyRowColumn = function (column, index, node) {\n    if (index != 0) {\n      this.result += this.columnSeparator;\n    }\n\n    this.result += this.putInQuotes(this.extractRowCellValue(column, index, constants_1.Constants.EXPORT_TYPE_CSV, node), this.suppressQuotes);\n    this.lineOpened = true;\n  };\n\n  CsvSerializingSession.prototype.putInQuotes = function (value, suppressQuotes) {\n    if (suppressQuotes) {\n      return value;\n    }\n\n    if (value === null || value === undefined) {\n      return '\"\"';\n    }\n\n    var stringValue;\n\n    if (typeof value === 'string') {\n      stringValue = value;\n    } else if (typeof value.toString === 'function') {\n      stringValue = value.toString();\n    } else {\n      console.warn('unknown value type during csv conversion');\n      stringValue = '';\n    } // replace each \" with \"\" (ie two sets of double quotes is how to do double quotes in csv)\n\n\n    var valueEscaped = stringValue.replace(/\"/g, \"\\\"\\\"\");\n    return '\"' + valueEscaped + '\"';\n  };\n\n  CsvSerializingSession.prototype.parse = function () {\n    return this.result;\n  };\n\n  return CsvSerializingSession;\n}(gridSerializer_1.BaseGridSerializingSession);\n\nexports.CsvSerializingSession = CsvSerializingSession;\n\nvar BaseCreator =\n/** @class */\nfunction () {\n  function BaseCreator() {}\n\n  BaseCreator.prototype.setBeans = function (beans) {\n    this.beans = beans;\n  };\n\n  BaseCreator.prototype.export = function (userParams) {\n    if (this.isExportSuppressed()) {\n      console.warn(\"ag-grid: Export canceled. Export is not allowed as per your configuration.\");\n      return '';\n    }\n\n    var _a = this.getMergedParamsAndData(userParams),\n        mergedParams = _a.mergedParams,\n        data = _a.data;\n\n    var fileNamePresent = mergedParams && mergedParams.fileName && mergedParams.fileName.length !== 0;\n    var fileName = fileNamePresent ? mergedParams.fileName : this.getDefaultFileName();\n\n    if (fileName.indexOf(\".\") === -1) {\n      fileName = fileName + \".\" + this.getDefaultFileExtension();\n    }\n\n    this.beans.downloader.download(fileName, this.packageFile(data));\n    return data;\n  };\n\n  BaseCreator.prototype.getData = function (params) {\n    return this.getMergedParamsAndData(params).data;\n  };\n\n  BaseCreator.prototype.getMergedParamsAndData = function (userParams) {\n    var mergedParams = this.mergeDefaultParams(userParams);\n    var data = this.beans.gridSerializer.serialize(this.createSerializingSession(mergedParams), mergedParams);\n    return {\n      mergedParams: mergedParams,\n      data: data\n    };\n  };\n\n  BaseCreator.prototype.mergeDefaultParams = function (userParams) {\n    var baseParams = this.beans.gridOptionsWrapper.getDefaultExportParams();\n    var params = {};\n\n    utils_1._.assign(params, baseParams);\n\n    utils_1._.assign(params, userParams);\n\n    return params;\n  };\n\n  BaseCreator.prototype.packageFile = function (data) {\n    return new Blob([\"\\uFEFF\", data], {\n      type: window.navigator.msSaveOrOpenBlob ? this.getMimeType() : 'octet/stream'\n    });\n  };\n\n  return BaseCreator;\n}();\n\nexports.BaseCreator = BaseCreator;\n\nvar CsvCreator =\n/** @class */\nfunction (_super) {\n  __extends(CsvCreator, _super);\n\n  function CsvCreator() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  CsvCreator.prototype.postConstruct = function () {\n    this.setBeans({\n      downloader: this.downloader,\n      gridSerializer: this.gridSerializer,\n      gridOptionsWrapper: this.gridOptionsWrapper\n    });\n  };\n\n  CsvCreator.prototype.exportDataAsCsv = function (params) {\n    return this.export(params);\n  };\n\n  CsvCreator.prototype.getDataAsCsv = function (params) {\n    return this.getData(params);\n  };\n\n  CsvCreator.prototype.getMimeType = function () {\n    return 'text/csv;charset=utf-8;';\n  };\n\n  CsvCreator.prototype.getDefaultFileName = function () {\n    return 'export.csv';\n  };\n\n  CsvCreator.prototype.getDefaultFileExtension = function () {\n    return 'csv';\n  };\n\n  CsvCreator.prototype.createSerializingSession = function (params) {\n    var _a = this,\n        columnController = _a.columnController,\n        valueService = _a.valueService,\n        gridOptionsWrapper = _a.gridOptionsWrapper;\n\n    var processCellCallback = params.processCellCallback,\n        processHeaderCallback = params.processHeaderCallback,\n        suppressQuotes = params.suppressQuotes,\n        columnSeparator = params.columnSeparator;\n    return new CsvSerializingSession({\n      columnController: columnController,\n      valueService: valueService,\n      gridOptionsWrapper: gridOptionsWrapper,\n      processCellCallback: processCellCallback || null,\n      processHeaderCallback: processHeaderCallback || null,\n      suppressQuotes: suppressQuotes,\n      columnSeparator: columnSeparator || ','\n    });\n  };\n\n  CsvCreator.prototype.isExportSuppressed = function () {\n    return this.gridOptionsWrapper.isSuppressCsvExport();\n  };\n\n  __decorate([context_1.Autowired('columnController'), __metadata(\"design:type\", columnController_1.ColumnController)], CsvCreator.prototype, \"columnController\", void 0);\n\n  __decorate([context_1.Autowired('valueService'), __metadata(\"design:type\", valueService_1.ValueService)], CsvCreator.prototype, \"valueService\", void 0);\n\n  __decorate([context_1.Autowired('downloader'), __metadata(\"design:type\", downloader_1.Downloader)], CsvCreator.prototype, \"downloader\", void 0);\n\n  __decorate([context_1.Autowired('gridSerializer'), __metadata(\"design:type\", gridSerializer_1.GridSerializer)], CsvCreator.prototype, \"gridSerializer\", void 0);\n\n  __decorate([context_1.Autowired('gridOptionsWrapper'), __metadata(\"design:type\", gridOptionsWrapper_1.GridOptionsWrapper)], CsvCreator.prototype, \"gridOptionsWrapper\", void 0);\n\n  __decorate([context_1.PostConstruct, __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", []), __metadata(\"design:returntype\", void 0)], CsvCreator.prototype, \"postConstruct\", null);\n\n  CsvCreator = __decorate([context_1.Bean('csvCreator')], CsvCreator);\n  return CsvCreator;\n}(BaseCreator);\n\nexports.CsvCreator = CsvCreator;","map":null,"metadata":{},"sourceType":"script"}