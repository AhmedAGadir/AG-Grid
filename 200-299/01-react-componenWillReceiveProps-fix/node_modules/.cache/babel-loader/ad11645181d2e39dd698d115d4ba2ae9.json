{"ast":null,"code":"/**\n * ag-grid-community - Advanced Data Grid / Data Table supporting Javascript / React / AngularJS / Web Components\n * @version v19.1.4\n * @link http://www.ag-grid.com/\n * @license MIT\n */\n\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar component_1 = require(\"../widgets/component\");\n\nvar context_1 = require(\"../context/context\");\n\nvar gridOptionsWrapper_1 = require(\"../gridOptionsWrapper\");\n\nvar columnController_1 = require(\"../columnController/columnController\");\n\nvar column_1 = require(\"../entities/column\");\n\nvar eventService_1 = require(\"../eventService\");\n\nvar events_1 = require(\"../events\");\n\nvar utils_1 = require(\"../utils\");\n\nvar headerWrapperComp_1 = require(\"./header/headerWrapperComp\");\n\nvar headerGroupWrapperComp_1 = require(\"./headerGroup/headerGroupWrapperComp\");\n\nvar filterManager_1 = require(\"../filter/filterManager\");\n\nvar componentRecipes_1 = require(\"../components/framework/componentRecipes\");\n\nvar gridApi_1 = require(\"../gridApi\");\n\nvar constants_1 = require(\"../constants\");\n\nvar HeaderRowType;\n\n(function (HeaderRowType) {\n  HeaderRowType[HeaderRowType[\"COLUMN_GROUP\"] = 0] = \"COLUMN_GROUP\";\n  HeaderRowType[HeaderRowType[\"COLUMN\"] = 1] = \"COLUMN\";\n  HeaderRowType[HeaderRowType[\"FLOATING_FILTER\"] = 2] = \"FLOATING_FILTER\";\n})(HeaderRowType = exports.HeaderRowType || (exports.HeaderRowType = {}));\n\nvar HeaderRowComp =\n/** @class */\nfunction (_super) {\n  __extends(HeaderRowComp, _super);\n\n  function HeaderRowComp(dept, type, pinned, dropTarget) {\n    var _this = _super.call(this, \"<div class=\\\"ag-header-row\\\" role=\\\"presentation\\\"/>\") || this;\n\n    _this.headerComps = {};\n    _this.dept = dept;\n    _this.type = type;\n    _this.pinned = pinned;\n    _this.dropTarget = dropTarget;\n    return _this;\n  }\n\n  HeaderRowComp.prototype.forEachHeaderElement = function (callback) {\n    var _this = this;\n\n    Object.keys(this.headerComps).forEach(function (key) {\n      callback(_this.headerComps[key]);\n    });\n  };\n\n  HeaderRowComp.prototype.destroy = function () {\n    var idsOfAllChildren = Object.keys(this.headerComps);\n    this.removeAndDestroyChildComponents(idsOfAllChildren);\n\n    _super.prototype.destroy.call(this);\n  };\n\n  HeaderRowComp.prototype.removeAndDestroyChildComponents = function (idsToDestroy) {\n    var _this = this;\n\n    idsToDestroy.forEach(function (id) {\n      var childHeaderComp = _this.headerComps[id];\n\n      _this.getGui().removeChild(childHeaderComp.getGui());\n\n      if (childHeaderComp.destroy) {\n        childHeaderComp.destroy();\n      }\n\n      delete _this.headerComps[id];\n    });\n  };\n\n  HeaderRowComp.prototype.onRowHeightChanged = function () {\n    var headerRowCount = this.columnController.getHeaderRowCount();\n    var sizes = [];\n    var numberOfFloating = 0;\n    var groupHeight;\n    var headerHeight;\n\n    if (!this.columnController.isPivotMode()) {\n      if (this.gridOptionsWrapper.isFloatingFilter()) {\n        headerRowCount++;\n      }\n\n      numberOfFloating = this.gridOptionsWrapper.isFloatingFilter() ? 1 : 0;\n      groupHeight = this.gridOptionsWrapper.getGroupHeaderHeight();\n      headerHeight = this.gridOptionsWrapper.getHeaderHeight();\n    } else {\n      numberOfFloating = 0;\n      groupHeight = this.gridOptionsWrapper.getPivotGroupHeaderHeight();\n      headerHeight = this.gridOptionsWrapper.getPivotHeaderHeight();\n    }\n\n    var numberOfNonGroups = 1 + numberOfFloating;\n    var numberOfGroups = headerRowCount - numberOfNonGroups;\n\n    for (var i = 0; i < numberOfGroups; i++) {\n      sizes.push(groupHeight);\n    }\n\n    sizes.push(headerHeight);\n\n    for (var i = 0; i < numberOfFloating; i++) {\n      sizes.push(this.gridOptionsWrapper.getFloatingFiltersHeight());\n    }\n\n    var rowHeight = 0;\n\n    for (var i = 0; i < this.dept; i++) {\n      rowHeight += sizes[i];\n    }\n\n    this.getGui().style.top = rowHeight + 'px';\n    this.getGui().style.height = sizes[this.dept] + 'px';\n  }; //noinspection JSUnusedLocalSymbols\n\n\n  HeaderRowComp.prototype.init = function () {\n    this.onRowHeightChanged();\n    this.onVirtualColumnsChanged();\n    this.setWidth();\n    this.addDestroyableEventListener(this.gridOptionsWrapper, gridOptionsWrapper_1.GridOptionsWrapper.PROP_HEADER_HEIGHT, this.onRowHeightChanged.bind(this));\n    this.addDestroyableEventListener(this.gridOptionsWrapper, gridOptionsWrapper_1.GridOptionsWrapper.PROP_PIVOT_HEADER_HEIGHT, this.onRowHeightChanged.bind(this));\n    this.addDestroyableEventListener(this.gridOptionsWrapper, gridOptionsWrapper_1.GridOptionsWrapper.PROP_GROUP_HEADER_HEIGHT, this.onRowHeightChanged.bind(this));\n    this.addDestroyableEventListener(this.gridOptionsWrapper, gridOptionsWrapper_1.GridOptionsWrapper.PROP_PIVOT_GROUP_HEADER_HEIGHT, this.onRowHeightChanged.bind(this));\n    this.addDestroyableEventListener(this.gridOptionsWrapper, gridOptionsWrapper_1.GridOptionsWrapper.PROP_FLOATING_FILTERS_HEIGHT, this.onRowHeightChanged.bind(this));\n    this.addDestroyableEventListener(this.eventService, events_1.Events.EVENT_VIRTUAL_COLUMNS_CHANGED, this.onVirtualColumnsChanged.bind(this));\n    this.addDestroyableEventListener(this.eventService, events_1.Events.EVENT_DISPLAYED_COLUMNS_CHANGED, this.onDisplayedColumnsChanged.bind(this));\n    this.addDestroyableEventListener(this.eventService, events_1.Events.EVENT_COLUMN_RESIZED, this.onColumnResized.bind(this));\n    this.addDestroyableEventListener(this.eventService, events_1.Events.EVENT_GRID_COLUMNS_CHANGED, this.onGridColumnsChanged.bind(this));\n  };\n\n  HeaderRowComp.prototype.onColumnResized = function () {\n    this.setWidth();\n  };\n\n  HeaderRowComp.prototype.setWidth = function () {\n    var width = this.getWidthForRow();\n    this.getGui().style.width = width + 'px';\n  };\n\n  HeaderRowComp.prototype.getWidthForRow = function () {\n    var printLayout = this.gridOptionsWrapper.getDomLayout() === constants_1.Constants.DOM_LAYOUT_PRINT;\n\n    if (printLayout) {\n      var centerRow = utils_1.Utils.missing(this.pinned);\n\n      if (centerRow) {\n        return this.columnController.getContainerWidth(column_1.Column.PINNED_RIGHT) + this.columnController.getContainerWidth(column_1.Column.PINNED_LEFT) + this.columnController.getContainerWidth(null);\n      } else {\n        return 0;\n      }\n    } else {\n      // if not printing, just return the width as normal\n      return this.columnController.getContainerWidth(this.pinned);\n    }\n  };\n\n  HeaderRowComp.prototype.onGridColumnsChanged = function () {\n    this.removeAndDestroyAllChildComponents();\n  };\n\n  HeaderRowComp.prototype.removeAndDestroyAllChildComponents = function () {\n    var idsOfAllChildren = Object.keys(this.headerComps);\n    this.removeAndDestroyChildComponents(idsOfAllChildren);\n  };\n\n  HeaderRowComp.prototype.onDisplayedColumnsChanged = function () {\n    this.onVirtualColumnsChanged();\n    this.setWidth();\n  };\n\n  HeaderRowComp.prototype.getItemsAtDept = function () {\n    var _this = this;\n\n    var printLayout = this.gridOptionsWrapper.getDomLayout() === constants_1.Constants.DOM_LAYOUT_PRINT;\n\n    if (printLayout) {\n      // for print layout, we add all columns into the center\n      var centerContainer = utils_1.Utils.missing(this.pinned);\n\n      if (centerContainer) {\n        var result_1 = [];\n        [column_1.Column.PINNED_LEFT, null, column_1.Column.PINNED_RIGHT].forEach(function (pinned) {\n          var items = _this.columnController.getVirtualHeaderGroupRow(pinned, _this.type == HeaderRowType.FLOATING_FILTER ? _this.dept - 1 : _this.dept);\n\n          result_1 = result_1.concat(items);\n        });\n        return result_1;\n      } else {\n        return [];\n      }\n    } else {\n      // when in normal layout, we add the columns for that container only\n      return this.columnController.getVirtualHeaderGroupRow(this.pinned, this.type == HeaderRowType.FLOATING_FILTER ? this.dept - 1 : this.dept);\n    }\n  };\n\n  HeaderRowComp.prototype.onVirtualColumnsChanged = function () {\n    var _this = this;\n\n    var currentChildIds = Object.keys(this.headerComps);\n    var itemsAtDepth = this.getItemsAtDept();\n    var ensureDomOrder = this.gridOptionsWrapper.isEnsureDomOrder();\n    var eBefore;\n    itemsAtDepth.forEach(function (child) {\n      // skip groups that have no displayed children. this can happen when the group is broken,\n      // and this section happens to have nothing to display for the open / closed state.\n      // (a broken group is one that is split, ie columns in the group have a non-group column\n      // in between them)\n      if (child.isEmptyGroup()) {\n        return;\n      }\n\n      var idOfChild = child.getUniqueId();\n\n      var eParentContainer = _this.getGui(); // if we already have this cell rendered, do nothing\n\n\n      var colAlreadyInDom = currentChildIds.indexOf(idOfChild) >= 0;\n      var headerComp;\n      var eHeaderCompGui;\n\n      if (colAlreadyInDom) {\n        utils_1.Utils.removeFromArray(currentChildIds, idOfChild);\n        headerComp = _this.headerComps[idOfChild];\n        eHeaderCompGui = headerComp.getGui();\n\n        if (ensureDomOrder) {\n          utils_1.Utils.ensureDomOrder(eParentContainer, eHeaderCompGui, eBefore);\n        }\n\n        eBefore = eHeaderCompGui;\n      } else {\n        headerComp = _this.createHeaderComp(child);\n        _this.headerComps[idOfChild] = headerComp;\n        eHeaderCompGui = headerComp.getGui();\n\n        if (ensureDomOrder) {\n          utils_1.Utils.insertWithDomOrder(eParentContainer, eHeaderCompGui, eBefore);\n        } else {\n          eParentContainer.appendChild(eHeaderCompGui);\n        }\n\n        eBefore = eHeaderCompGui;\n      }\n    }); // at this point, anything left in currentChildIds is an element that is no longer in the viewport\n\n    this.removeAndDestroyChildComponents(currentChildIds);\n  };\n\n  HeaderRowComp.prototype.createHeaderComp = function (columnGroupChild) {\n    var result;\n\n    switch (this.type) {\n      case HeaderRowType.COLUMN:\n        result = new headerWrapperComp_1.HeaderWrapperComp(columnGroupChild, this.dropTarget, this.pinned);\n        break;\n\n      case HeaderRowType.COLUMN_GROUP:\n        result = new headerGroupWrapperComp_1.HeaderGroupWrapperComp(columnGroupChild, this.dropTarget, this.pinned);\n        break;\n\n      case HeaderRowType.FLOATING_FILTER:\n        var column = columnGroupChild;\n        result = this.createFloatingFilterWrapper(column);\n        break;\n    }\n\n    this.context.wireBean(result);\n    return result;\n  };\n\n  HeaderRowComp.prototype.createFloatingFilterWrapper = function (column) {\n    var _this = this;\n\n    var floatingFilterParams = this.createFloatingFilterParams(column);\n    var floatingFilterWrapper = this.componentRecipes.newFloatingFilterWrapperComponent(column, floatingFilterParams);\n    this.addDestroyableEventListener(column, column_1.Column.EVENT_FILTER_CHANGED, function () {\n      var filterComponentPromise = _this.filterManager.getFilterComponent(column, 'NO_UI');\n\n      floatingFilterWrapper.onParentModelChanged(filterComponentPromise.resolveNow(null, function (filter) {\n        return filter.getModel();\n      }));\n    });\n    var cachedFilter = this.filterManager.cachedFilter(column);\n\n    if (cachedFilter) {\n      var filterComponentPromise = this.filterManager.getFilterComponent(column, 'NO_UI');\n      floatingFilterWrapper.onParentModelChanged(filterComponentPromise.resolveNow(null, function (filter) {\n        return filter.getModel();\n      }));\n    }\n\n    return floatingFilterWrapper;\n  };\n\n  HeaderRowComp.prototype.createFloatingFilterParams = function (column) {\n    var _this = this; // We always get the freshest reference to the baseFilter because the filters get sometimes created\n    // and destroyed between calls\n    //\n    // let filterComponent:BaseFilter<any, any, any> = <any>this.filterManager.getFilterComponent(column);\n    //\n\n\n    var baseParams = {\n      api: this.gridApi,\n      column: column,\n      currentParentModel: function currentParentModel() {\n        var filterComponentPromise = _this.filterManager.getFilterComponent(column, 'NO_UI');\n\n        var wholeParentFilter = filterComponentPromise.resolveNow(null, function (filter) {\n          return filter.getNullableModel ? filter.getNullableModel() : filter.getModel();\n        });\n        return wholeParentFilter && wholeParentFilter.operator != null ? wholeParentFilter.condition1 : wholeParentFilter;\n      },\n      onFloatingFilterChanged: function onFloatingFilterChanged(change) {\n        var captureModelChangedResolveFunc;\n        var modelChanged = new utils_1.Promise(function (resolve) {\n          captureModelChangedResolveFunc = resolve;\n        });\n\n        var filterComponentPromise = _this.filterManager.getFilterComponent(column, 'NO_UI');\n\n        filterComponentPromise.then(function (filterComponent) {\n          if (filterComponent.onFloatingFilterChanged) {\n            //If going through this branch of code the user MUST\n            //be passing an object of type change that contains\n            //a model propery inside and some other stuff\n            var result = filterComponent.onFloatingFilterChanged(change);\n            captureModelChangedResolveFunc(result);\n          } else {\n            //If going through this branch of code the user MUST\n            //be passing the plain model and delegating to ag-Grid\n            //the responsibility to set the parent model and refresh\n            //the filters\n            filterComponent.setModel(change);\n\n            _this.filterManager.onFilterChanged();\n\n            captureModelChangedResolveFunc(true);\n          }\n        });\n        return modelChanged.resolveNow(true, function (modelChanged) {\n          return modelChanged;\n        });\n      },\n      //This one might be overriden from the colDef\n      suppressFilterButton: false\n    };\n    return baseParams;\n  };\n\n  __decorate([context_1.Autowired('gridOptionsWrapper'), __metadata(\"design:type\", gridOptionsWrapper_1.GridOptionsWrapper)], HeaderRowComp.prototype, \"gridOptionsWrapper\", void 0);\n\n  __decorate([context_1.Autowired('gridApi'), __metadata(\"design:type\", gridApi_1.GridApi)], HeaderRowComp.prototype, \"gridApi\", void 0);\n\n  __decorate([context_1.Autowired('columnController'), __metadata(\"design:type\", columnController_1.ColumnController)], HeaderRowComp.prototype, \"columnController\", void 0);\n\n  __decorate([context_1.Autowired('context'), __metadata(\"design:type\", context_1.Context)], HeaderRowComp.prototype, \"context\", void 0);\n\n  __decorate([context_1.Autowired('eventService'), __metadata(\"design:type\", eventService_1.EventService)], HeaderRowComp.prototype, \"eventService\", void 0);\n\n  __decorate([context_1.Autowired('filterManager'), __metadata(\"design:type\", filterManager_1.FilterManager)], HeaderRowComp.prototype, \"filterManager\", void 0);\n\n  __decorate([context_1.Autowired('componentRecipes'), __metadata(\"design:type\", componentRecipes_1.ComponentRecipes)], HeaderRowComp.prototype, \"componentRecipes\", void 0);\n\n  __decorate([context_1.PostConstruct, __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", []), __metadata(\"design:returntype\", void 0)], HeaderRowComp.prototype, \"init\", null);\n\n  return HeaderRowComp;\n}(component_1.Component);\n\nexports.HeaderRowComp = HeaderRowComp;","map":null,"metadata":{},"sourceType":"script"}